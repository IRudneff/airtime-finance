<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no"/>
  <meta name="theme-color" content="#0f0f1e"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="Air Time"/>
  <title>Air Time â€” Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑÑ‹</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700&family=DM+Sans:wght@400;600&display=swap');
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:#0f0f1e;min-height:100vh;font-family:'DM Sans',sans-serif;}
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0;}
    ::-webkit-scrollbar{width:3px;}
    ::-webkit-scrollbar-track{background:#0f0f1e;}
    ::-webkit-scrollbar-thumb{background:#3a3a5a;border-radius:2px;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .sync-dot{width:6px;height:6px;border-radius:50%;display:inline-block;margin-right:6px;}
    .sync-dot.cloud{background:#22c55e;animation:pulse 2s infinite;}
    .sync-dot.local{background:#f59e0b;}
    .sync-dot.error{background:#ef4444;}
    .sync-dot.connecting{background:#3b82f6;animation:pulse 1s infinite;}
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FIREBASE CONFIG
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyC51J93AA-IDYvab2jzuJjFPxFTO6OD3IE",
  authDomain: "airtime-finance.firebaseapp.com",
  projectId: "airtime-finance",
  storageBucket: "airtime-finance.firebasestorage.app",
  messagingSenderId: "897898898287",
  appId: "1:897898898287:web:b42c91c339a4ec2fe7be9a",
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Firebase module â€” real-time sync with onSnapshot
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let db = null;
let firebaseModules = null;
let firebaseStatus = "connecting";
let statusListeners = [];

function onStatusChange(fn) {
  statusListeners.push(fn);
  return () => { statusListeners = statusListeners.filter(f => f !== fn); };
}
function setStatus(s) {
  firebaseStatus = s;
  statusListeners.forEach(fn => fn(s));
}

async function initFirebase() {
  try {
    setStatus("connecting");
    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js");
    const {
      getFirestore, doc, getDoc, setDoc, onSnapshot
    } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");

    const app = initializeApp(FIREBASE_CONFIG);
    db = getFirestore(app);
    firebaseModules = { doc, getDoc, setDoc, onSnapshot };
    setStatus("cloud");
    return true;
  } catch(e) {
    console.error("Firebase init error:", e);
    setStatus("error");
    return false;
  }
}

// Load once (for initial data)
async function loadOnce(key) {
  if (db && firebaseModules) {
    try {
      const snap = await firebaseModules.getDoc(
        firebaseModules.doc(db, "airtime", key)
      );
      if (snap.exists()) return snap.data().value;
    } catch(e) {
      console.warn("Firebase loadOnce error:", e);
    }
  }
  const local = localStorage.getItem("at_" + key);
  return local || null;
}

// Subscribe to real-time changes (returns unsubscribe function)
function subscribe(key, callback) {
  if (db && firebaseModules) {
    try {
      const docRef = firebaseModules.doc(db, "airtime", key);
      return firebaseModules.onSnapshot(docRef, (snap) => {
        if (snap.exists()) {
          callback(snap.data().value);
        }
      }, (error) => {
        console.warn("Snapshot error for", key, error);
        setStatus("error");
      });
    } catch(e) {
      console.warn("Subscribe error:", e);
    }
  }
  return () => {};
}

// Save to Firebase + localStorage backup
async function saveData(key, value) {
  localStorage.setItem("at_" + key, value);

  if (db && firebaseModules) {
    try {
      await firebaseModules.setDoc(
        firebaseModules.doc(db, "airtime", key),
        { value, updatedAt: new Date().toISOString() }
      );
    } catch(e) {
      console.warn("Firebase save error:", e);
      setStatus("error");
    }
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const { useState, useEffect, useCallback, useRef } = React;

const ACCOUNTS = ["ĞŸÑ€Ğ¾Ğ´Ğ°ĞºÑˆĞ½", "ĞšĞ¸Ğ±ĞµÑ€ÑĞ¿Ğ¾Ñ€Ñ‚", "ĞĞ°Ğ»"];
const INCOME_CATS = ["Ğ¡ÑŠÑ‘Ğ¼ĞºĞ°", "ĞœĞ¾Ğ½Ñ‚Ğ°Ğ¶/Ğ¿Ğ¾ÑÑ‚Ğ¿Ñ€Ğ¾Ğ´", "Ğ¢Ñ€Ğ°Ğ½ÑĞ»ÑÑ†Ğ¸Ñ", "Ğ’ĞµĞ±Ğ¸Ğ½Ğ°Ñ€", "Ğ’Ñ‹ĞµĞ·Ğ´Ğ½Ğ°Ñ ÑÑŠÑ‘Ğ¼ĞºĞ°", "AI-Ğ²Ğ¸Ğ´ĞµĞ¾", "ĞŸÑ€Ğ¾Ñ‡Ğ¸Ğ¹ Ğ´Ğ¾Ñ…Ğ¾Ğ´"];
const EXPENSE_CATS = ["ĞšĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°", "Ğ—Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ°", "ĞÑ€ĞµĞ½Ğ´Ğ°/Ñ…Ğ¾Ğ·", "Ğ ĞµĞºĞ»Ğ°Ğ¼Ğ°", "ĞĞ±Ğ¾Ñ€ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ", "ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸/ĞŸĞ", "ĞĞ°Ğ»Ğ¾Ğ³Ğ¸/Ğ±ÑƒÑ…Ğ³Ğ°Ğ»Ñ‚ĞµÑ€", "ĞŸÑ€Ğ¾Ñ‡ĞµĞµ"];
const MONTHS = ["Ğ¯Ğ½Ğ²","Ğ¤ĞµĞ²","ĞœĞ°Ñ€","ĞĞ¿Ñ€","ĞœĞ°Ğ¹","Ğ˜ÑĞ½","Ğ˜ÑĞ»","ĞĞ²Ğ³","Ğ¡ĞµĞ½","ĞĞºÑ‚","ĞĞ¾Ñ","Ğ”ĞµĞº"];
const ICONS = { "ĞŸÑ€Ğ¾Ğ´Ğ°ĞºÑˆĞ½":"ğŸ¬", "ĞšĞ¸Ğ±ĞµÑ€ÑĞ¿Ğ¾Ñ€Ñ‚":"ğŸ®", "ĞĞ°Ğ»":"ğŸ’µ" };

const C = {
  bg:"#0f0f1e", card:"#1a1a30", card2:"#222238",
  border:"#2e2e4a", accent:"#7c3aed", al:"#a78bfa",
  green:"#22c55e", red:"#ef4444", amber:"#f59e0b", blue:"#3b82f6",
  text:"#e2e2f0", sub:"#7878a0", muted:"#3a3a5a", white:"#ffffff"
};

const fmt = n => new Intl.NumberFormat("ru-RU").format(Math.round(n||0)) + " Ñ€.";

function mKey(d) {
  const dt = new Date(d);
  return `${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,"0")}`;
}
function mLabel(k) {
  const [y,m] = k.split("-");
  return `${MONTHS[parseInt(m)-1]} ${y}`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UI Components
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const Card = ({children,style={}}) => <div style={{background:C.card,borderRadius:18,padding:16,...style}}>{children}</div>;
const Lbl = ({children}) => <div style={{fontSize:11,color:C.sub,letterSpacing:1.5,textTransform:"uppercase",marginBottom:10}}>{children}</div>;

const ChoiceBtn = ({label,icon,active,onClick,color}) => (
  <button onClick={onClick} style={{
    flex:1,padding:"16px 10px",borderRadius:14,
    border:`2px solid ${active?color:C.border}`,
    background:active?color+"20":C.card2,
    color:active?color:C.sub,cursor:"pointer",
    fontSize:13,fontFamily:"'Unbounded',sans-serif",fontWeight:active?700:400,
    display:"flex",flexDirection:"column",alignItems:"center",gap:8,
    transition:"all .2s",transform:active?"scale(1.04)":"scale(1)",
  }}>
    <span style={{fontSize:26}}>{icon}</span>{label}
  </button>
);

const PillBtn = ({label,active,onClick,color=C.accent}) => (
  <button onClick={onClick} style={{
    padding:"9px 16px",borderRadius:50,
    border:`1.5px solid ${active?color:C.border}`,
    background:active?color:"transparent",
    color:active?C.white:C.sub,cursor:"pointer",
    fontSize:13,fontWeight:active?600:400,
    transition:"all .15s",whiteSpace:"nowrap",
  }}>{label}</button>
);

const Dots = ({total,cur}) => (
  <div style={{display:"flex",gap:6,justifyContent:"center",margin:"8px 0 18px"}}>
    {Array.from({length:total}).map((_,i)=>(
      <div key={i} style={{
        width:i===cur?22:7,height:7,borderRadius:4,
        background:i<cur?C.al:i===cur?C.accent:C.muted,
        transition:"all .3s"
      }}/>
    ))}
  </div>
);

const NumInput = ({value,onChange,placeholder="0",autoFocus=false}) => (
  <div style={{position:"relative"}}>
    <input type="number" placeholder={placeholder} value={value} onChange={onChange} autoFocus={autoFocus} style={{
      width:"100%",boxSizing:"border-box",padding:"16px 52px 16px 16px",
      background:C.card2,border:`2px solid ${C.border}`,
      borderRadius:14,color:C.white,fontSize:30,
      fontFamily:"'Unbounded',sans-serif",outline:"none",
    }}/>
    <span style={{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",color:C.sub,fontSize:16}}>Ñ€.</span>
  </div>
);

const TxtInput = ({value,onChange,placeholder}) => (
  <input type="text" placeholder={placeholder} value={value} onChange={onChange} style={{
    width:"100%",boxSizing:"border-box",padding:"12px 14px",
    background:C.card2,border:`2px solid ${C.border}`,
    borderRadius:12,color:C.white,fontSize:14,outline:"none",
  }}/>
);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Sync Status Badge
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SyncBadge({status}) {
  const labels = {
    cloud: "â˜ï¸ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°",
    local: "ğŸ’¾ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾",
    error: "âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸",
    connecting: "ğŸ”„ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ...",
  };
  const colors = {
    cloud: C.green,
    local: C.amber,
    error: C.red,
    connecting: C.blue,
  };
  return (
    <div style={{textAlign:"center",marginBottom:10,animation:"fadeIn .4s"}}>
      <span style={{fontSize:11,color:colors[status]||C.sub,display:"inline-flex",alignItems:"center",gap:4}}>
        <span className={`sync-dot ${status}`}/>
        {labels[status] || status}
      </span>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EntryForm
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function EntryForm({onSave}) {
  const [step,setStep] = useState(0);
  const [type,setType] = useState(null);
  const [acc,setAcc] = useState(null);
  const [pay,setPay] = useState(null);
  const [cat,setCat] = useState(null);
  const [amt,setAmt] = useState("");
  const [cmt,setCmt] = useState("");
  const [done,setDone] = useState(false);

  const isNal = acc === "ĞĞ°Ğ»";
  const STEPS = isNal ? 4 : 5;
  const cats = type==="income"?INCOME_CATS:EXPENSE_CATS;

  const effectivePay = isNal ? "cash" : pay;
  const ok = isNal
    ? [!!type, !!acc, !!cat, !!amt&&!isNaN(+amt)&&+amt>0]
    : [!!type, !!acc, !!pay, !!cat, !!amt&&!isNaN(+amt)&&+amt>0];

  function reset(){setStep(0);setType(null);setAcc(null);setPay(null);setCat(null);setAmt("");setCmt("");}

  function submit(){
    if(!ok[STEPS-1])return;
    onSave({id:Date.now(),date:new Date().toISOString(),type,account:acc,payType:effectivePay,category:cat,amount:+amt,comment:cmt});
    setDone(true);
    setTimeout(()=>{setDone(false);reset();},1500);
  }

  function chooseAcc(a) {
    setAcc(a);
    setPay(null);
  }

  if(done) return (
    <div style={{textAlign:"center",padding:"72px 0",animation:"slideUp .3s"}}>
      <div style={{fontSize:62,marginBottom:14}}>âœ…</div>
      <div style={{color:C.al,fontFamily:"'Unbounded',sans-serif",fontSize:17}}>Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾ Ğ¸ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!</div>
    </div>
  );

  const showPayStep = !isNal && step === 2;
  const showCatStep = isNal ? step === 2 : step === 3;
  const showAmtStep = isNal ? step === 3 : step === 4;

  return (
    <div style={{animation:"fadeIn .3s"}}>
      <Dots total={STEPS} cur={step}/>
      {step===0&&<><Lbl>Ğ¢Ğ¸Ğ¿ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸</Lbl><div style={{display:"flex",gap:12}}>
        <ChoiceBtn label="Ğ”Ğ¾Ñ…Ğ¾Ğ´" icon="ğŸ“ˆ" active={type==="income"} color={C.green} onClick={()=>setType("income")}/>
        <ChoiceBtn label="Ğ Ğ°ÑÑ…Ğ¾Ğ´" icon="ğŸ“‰" active={type==="expense"} color={C.red} onClick={()=>setType("expense")}/>
      </div></>}
      {step===1&&<><Lbl>Ğ¡Ñ‡Ñ‘Ñ‚</Lbl><div style={{display:"flex",gap:10}}>
        {ACCOUNTS.map(a=><ChoiceBtn key={a} label={a} icon={ICONS[a]} active={acc===a} color={C.accent} onClick={()=>chooseAcc(a)}/>)}
      </div></>}
      {showPayStep&&<><Lbl>Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹</Lbl><div style={{display:"flex",gap:12}}>
        <ChoiceBtn label="ĞĞ°Ğ»" icon="ğŸ’µ" active={pay==="cash"} color={C.amber} onClick={()=>setPay("cash")}/>
        <ChoiceBtn label="Ğ‘ĞµĞ·Ğ½Ğ°Ğ»" icon="ğŸ’³" active={pay==="card"} color={C.blue} onClick={()=>setPay("card")}/>
      </div></>}
      {showCatStep&&<><Lbl>ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</Lbl><div style={{display:"flex",flexWrap:"wrap",gap:8}}>
        {cats.map(c=><PillBtn key={c} label={c} active={cat===c} onClick={()=>setCat(c)}/>)}
      </div></>}
      {showAmtStep&&<>
        <Lbl>Ğ¡ÑƒĞ¼Ğ¼Ğ°</Lbl>
        <NumInput value={amt} onChange={e=>setAmt(e.target.value)} autoFocus={true}/>
        <div style={{marginTop:14,marginBottom:6}}><Lbl>ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</Lbl></div>
        <TxtInput value={cmt} onChange={e=>setCmt(e.target.value)} placeholder="ĞšĞ»Ğ¸ĞµĞ½Ñ‚, Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ..."/>
        <Card style={{marginTop:16,background:C.card2,fontSize:13,color:C.sub,lineHeight:2}}>
          <span style={{color:type==="income"?C.green:C.red,fontWeight:700}}>{type==="income"?"â–² Ğ”Ğ¾Ñ…Ğ¾Ğ´":"â–¼ Ğ Ğ°ÑÑ…Ğ¾Ğ´"}</span>
          {"  Â·  "}{acc}{!isNal&&("  Â·  "+(effectivePay==="cash"?"ğŸ’µ ĞĞ°Ğ»":"ğŸ’³ Ğ‘ĞµĞ·Ğ½Ğ°Ğ»"))}{"  Â·  "}{cat}
        </Card>
      </>}
      <div style={{display:"flex",gap:10,marginTop:22}}>
        {step>0&&<button onClick={()=>setStep(s=>s-1)} style={{padding:"13px 18px",borderRadius:12,border:"none",background:C.card2,color:C.sub,cursor:"pointer",fontSize:14,fontWeight:600}}>â† ĞĞ°Ğ·Ğ°Ğ´</button>}
        {step<STEPS-1
          ?<button onClick={()=>ok[step]&&setStep(s=>s+1)} disabled={!ok[step]} style={{flex:1,padding:"13px",borderRadius:12,border:"none",background:ok[step]?C.accent:C.muted,color:C.white,cursor:ok[step]?"pointer":"default",opacity:ok[step]?1:0.45,fontSize:15,fontWeight:700,transition:"all .2s"}}>Ğ”Ğ°Ğ»ĞµĞµ â†’</button>
          :<button onClick={submit} disabled={!ok[STEPS-1]} style={{flex:1,padding:"13px",borderRadius:12,border:"none",background:ok[STEPS-1]?C.green:C.muted,color:C.white,cursor:ok[STEPS-1]?"pointer":"default",opacity:ok[STEPS-1]?1:0.45,fontSize:15,fontWeight:700}}>ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
        }
      </div>
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// History
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function History({entries,onDelete}) {
  const sorted = [...entries].sort((a,b)=>new Date(b.date)-new Date(a.date));
  const byM = {};
  for(const e of sorted){const k=mKey(e.date);if(!byM[k])byM[k]=[];byM[k].push(e);}

  if(!entries.length) return (
    <div style={{textAlign:"center",padding:"60px 0",animation:"fadeIn .4s"}}>
      <div style={{fontSize:48,marginBottom:10}}>ğŸ“­</div>
      <div style={{color:C.sub}}>ĞĞµÑ‚ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹</div>
    </div>
  );

  return <div style={{animation:"fadeIn .3s"}}>
    {Object.keys(byM).sort((a,b)=>b.localeCompare(a)).map(month=>{
      const items=byM[month];
      const inc=items.filter(e=>e.type==="income").reduce((s,e)=>s+e.amount,0);
      const exp=items.filter(e=>e.type==="expense").reduce((s,e)=>s+e.amount,0);
      return <div key={month} style={{marginBottom:22}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
          <span style={{fontFamily:"'Unbounded',sans-serif",fontSize:12,color:C.al}}>{mLabel(month)}</span>
          <span style={{fontSize:12}}>
            <span style={{color:C.green}}>+{fmt(inc)}</span>
            <span style={{color:C.muted,margin:"0 5px"}}>Â·</span>
            <span style={{color:C.red}}>âˆ’{fmt(exp)}</span>
          </span>
        </div>
        {items.map(e=>(
          <div key={e.id} style={{display:"flex",alignItems:"center",gap:10,padding:"11px 13px",marginBottom:5,background:C.card,borderRadius:12,borderLeft:`3px solid ${e.type==="income"?C.green:C.red}`}}>
            <span style={{fontSize:18}}>{e.payType==="cash"?"ğŸ’µ":"ğŸ’³"}</span>
            <div style={{flex:1,minWidth:0}}>
              <div style={{fontSize:13,color:C.text,fontWeight:600}}>
                {e.category} <span style={{color:C.muted,fontWeight:400}}>Â· {e.account}</span>
              </div>
              {e.comment&&<div style={{fontSize:11,color:C.muted,marginTop:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{e.comment}</div>}
            </div>
            <div style={{textAlign:"right"}}>
              <div style={{fontFamily:"'Unbounded',sans-serif",fontSize:12,color:e.type==="income"?C.green:C.red,fontWeight:700}}>
                {e.type==="income"?"+":"âˆ’"}{fmt(e.amount)}
              </div>
              <div style={{fontSize:10,color:C.muted,marginTop:2}}>{new Date(e.date).toLocaleDateString("ru-RU")}</div>
            </div>
            <button onClick={()=>onDelete(e.id)} style={{background:"none",border:"none",color:C.muted,cursor:"pointer",fontSize:15,padding:"4px 6px",borderRadius:6,transition:"color .2s"}}
              onMouseOver={e=>e.currentTarget.style.color=C.red}
              onMouseOut={e=>e.currentTarget.style.color=C.muted}
            >âœ•</button>
          </div>
        ))}
      </div>;
    })}
  </div>;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BalanceCorrection
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function BalanceCorrection({overrides,onSave}) {
  const [vals,setVals] = useState(()=>{
    const i={};ACCOUNTS.forEach(a=>{i[a]=overrides[a]!==undefined?String(overrides[a]):"";});return i;
  });
  const [saved,setSaved] = useState(false);

  useEffect(()=>{
    const i={};ACCOUNTS.forEach(a=>{i[a]=overrides[a]!==undefined?String(overrides[a]):"";});
    setVals(i);
  },[overrides]);

  function submit(){
    const r={};ACCOUNTS.forEach(a=>{if(vals[a]!==""&&!isNaN(+vals[a]))r[a]=+vals[a];});
    onSave(r);setSaved(true);setTimeout(()=>setSaved(false),2000);
  }

  return <div style={{animation:"fadeIn .3s"}}>
    <Card style={{marginBottom:16,background:C.card2}}>
      <div style={{fontSize:13,color:C.sub,lineHeight:1.7}}>
        Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ğº Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ ÑÑ‡Ñ‘Ñ‚Ğµ. Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ Ğ¾ÑÑ‚Ğ°Ğ½ĞµÑ‚ÑÑ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹.
      </div>
    </Card>
    {ACCOUNTS.map(a=>(
      <div key={a} style={{marginBottom:18}}>
        <Lbl>{ICONS[a]}  {a}</Lbl>
        <NumInput value={vals[a]} onChange={e=>setVals(v=>({...v,[a]:e.target.value}))} placeholder="Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ğº"/>
      </div>
    ))}
    <button onClick={submit} style={{width:"100%",padding:"14px",borderRadius:14,border:"none",background:saved?C.green:C.accent,color:C.white,cursor:"pointer",fontSize:15,fontWeight:700,transition:"all .3s"}}>
      {saved?"âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾!":"ğŸ’¾ ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²ĞºÑƒ"}
    </button>
    {Object.keys(overrides).length>0&&<div style={{marginTop:22}}>
      <Lbl>ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸</Lbl>
      {ACCOUNTS.filter(a=>overrides[a]!==undefined).map(a=>(
        <div key={a} style={{display:"flex",justifyContent:"space-between",padding:"11px 0",borderBottom:`1px solid ${C.border}`,fontSize:13}}>
          <span style={{color:C.sub}}>{ICONS[a]}  {a}</span>
          <span style={{color:C.al,fontWeight:600}}>{fmt(overrides[a])}</span>
        </div>
      ))}
      <button onClick={()=>onSave({})} style={{marginTop:14,padding:"10px 16px",borderRadius:10,border:`1px solid ${C.border}`,background:"transparent",color:C.red,cursor:"pointer",fontSize:12}}>
        Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸
      </button>
    </div>}
  </div>;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Export
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doExport(entries, overrides) {
  const byM={};
  for(const e of entries){const k=mKey(e.date);if(!byM[k])byM[k]={inc:0,exp:0};if(e.type==="income")byM[k].inc+=e.amount;else byM[k].exp+=e.amount;}
  const rows=["Ğ”Ğ˜ĞĞĞœĞ˜ĞšĞ ĞŸĞ ĞœĞ•Ğ¡Ğ¯Ğ¦ĞĞœ",["ĞœĞµÑÑÑ†","Ğ”Ğ¾Ñ…Ğ¾Ğ´Ñ‹","Ğ Ğ°ÑÑ…Ğ¾Ğ´Ñ‹","ĞŸÑ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ","ĞœĞ°Ñ€Ğ¶Ğ° %"].join(";")];
  let tI=0,tE=0;
  for(const m of Object.keys(byM).sort()){const{inc,exp}=byM[m];tI+=inc;tE+=exp;rows.push([mLabel(m),inc,exp,inc-exp,inc>0?((inc-exp)/inc*100).toFixed(1)+"%":"0%"].join(";"));}
  rows.push(["Ğ˜Ğ¢ĞĞ“Ğ",tI,tE,tI-tE,tI>0?((tI-tE)/tI*100).toFixed(1)+"%":"0%"].join(";"));
  rows.push("","Ğ‘ĞĞ›ĞĞĞ¡Ğ« ĞŸĞ Ğ¡Ğ§Ğ•Ğ¢ĞĞœ",["Ğ¡Ñ‡Ñ‘Ñ‚","ĞÑÑ‚Ğ°Ñ‚Ğ¾Ğº","Ğ”Ğ¾Ñ…Ğ¾Ğ´Ñ‹","Ğ Ğ°ÑÑ…Ğ¾Ğ´Ñ‹"].join(";"));
  for(const a of ACCOUNTS){const inc=entries.filter(e=>e.account===a&&e.type==="income").reduce((s,e)=>s+e.amount,0);const exp=entries.filter(e=>e.account===a&&e.type==="expense").reduce((s,e)=>s+e.amount,0);rows.push([a,overrides[a]!==undefined?overrides[a]:(inc-exp),inc,exp].join(";"));}
  rows.push("","Ğ’Ğ¡Ğ• ĞĞŸĞ•Ğ ĞĞ¦Ğ˜Ğ˜",["Ğ”Ğ°Ñ‚Ğ°","Ğ¢Ğ¸Ğ¿","Ğ¡Ñ‡Ñ‘Ñ‚","ĞĞ°Ğ»/Ğ‘ĞµĞ·Ğ½Ğ°Ğ»","ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ","Ğ¡ÑƒĞ¼Ğ¼Ğ°","ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹"].join(";"));
  for(const e of [...entries].sort((a,b)=>new Date(b.date)-new Date(a.date))){rows.push([new Date(e.date).toLocaleDateString("ru-RU"),e.type==="income"?"Ğ”Ğ¾Ñ…Ğ¾Ğ´":"Ğ Ğ°ÑÑ…Ğ¾Ğ´",e.account,e.payType==="cash"?"ĞĞ°Ğ»":"Ğ‘ĞµĞ·Ğ½Ğ°Ğ»",e.category,e.amount,e.comment||""].join(";"));}
  const blob=new Blob(["\uFEFF"+rows.join("\n")],{type:"text/csv;charset=utf-8;"});
  const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=`airtime_${new Date().toLocaleDateString("ru-RU").replace(/\./g,"-")}.csv`;a.click();URL.revokeObjectURL(url);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Dashboard
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Dashboard({entries,overrides,onExport,sync}) {
  const tI=entries.filter(e=>e.type==="income").reduce((s,e)=>s+e.amount,0);
  const tE=entries.filter(e=>e.type==="expense").reduce((s,e)=>s+e.amount,0);
  const byM={};
  for(const e of entries){const k=mKey(e.date);if(!byM[k])byM[k]={inc:0,exp:0};if(e.type==="income")byM[k].inc+=e.amount;else byM[k].exp+=e.amount;}
  const months=Object.keys(byM).sort().slice(-6);
  const maxV=Math.max(...months.map(m=>Math.max(byM[m].inc,byM[m].exp)),1);

  return <div style={{animation:"fadeIn .3s"}}>
    <SyncBadge status={sync}/>

    <div style={{textAlign:"center",padding:"6px 0 18px"}}>
      <div style={{fontSize:11,color:C.sub,letterSpacing:2,textTransform:"uppercase",marginBottom:4}}>ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ</div>
      <div style={{fontFamily:"'Unbounded',sans-serif",fontSize:34,color:tI-tE>=0?C.green:C.red,fontWeight:700}}>
        {tI-tE>=0?"+":""}{fmt(tI-tE)}
      </div>
      <div style={{display:"flex",justifyContent:"center",gap:18,marginTop:8,fontSize:13}}>
        <span style={{color:C.green}}>â†‘ {fmt(tI)}</span>
        <span style={{color:C.red}}>â†“ {fmt(tE)}</span>
      </div>
    </div>

    <div style={{display:"flex",gap:8,marginBottom:16}}>
      {ACCOUNTS.map(a=>{
        const inc=entries.filter(e=>e.account===a&&e.type==="income").reduce((s,e)=>s+e.amount,0);
        const exp=entries.filter(e=>e.account===a&&e.type==="expense").reduce((s,e)=>s+e.amount,0);
        const ov=overrides[a];const d=ov!==undefined?ov:(inc-exp);
        return <Card key={a} style={{flex:1,background:C.card2,padding:"12px 10px",textAlign:"center"}}>
          <div style={{fontSize:18,marginBottom:4}}>{ICONS[a]}</div>
          <div style={{fontSize:10,color:C.sub,marginBottom:4}}>{a}</div>
          <div style={{fontFamily:"'Unbounded',sans-serif",fontSize:12,color:d>=0?C.al:C.red,fontWeight:700,lineHeight:1.3}}>{fmt(d)}</div>
          {ov!==undefined&&<div style={{fontSize:9,color:C.amber,marginTop:3}}>âœ± ÑĞºĞ¾Ñ€Ñ€.</div>}
        </Card>;
      })}
    </div>

    {months.length>0&&<Card style={{marginBottom:14}}>
      <div style={{fontSize:11,color:C.sub,letterSpacing:1,textTransform:"uppercase",marginBottom:14}}>Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ°</div>
      <div style={{display:"flex",alignItems:"flex-end",gap:6,height:90}}>
        {months.map(m=>{
          const{inc,exp}=byM[m];
          return <div key={m} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center"}}>
            <div style={{display:"flex",gap:3,alignItems:"flex-end",height:82}}>
              <div style={{width:10,height:Math.max(Math.round((inc/maxV)*80),2),background:C.green,borderRadius:"3px 3px 0 0",opacity:.85,transition:"height .5s"}}/>
              <div style={{width:10,height:Math.max(Math.round((exp/maxV)*80),2),background:C.red,borderRadius:"3px 3px 0 0",opacity:.85,transition:"height .5s"}}/>
            </div>
            <div style={{fontSize:9,color:C.sub,marginTop:4}}>{mLabel(m).slice(0,3)}</div>
          </div>;
        })}
      </div>
      <div style={{display:"flex",gap:14,marginTop:8,fontSize:11,color:C.sub}}>
        <span><span style={{color:C.green}}>â– </span> Ğ”Ğ¾Ñ…Ğ¾Ğ´</span>
        <span><span style={{color:C.red}}>â– </span> Ğ Ğ°ÑÑ…Ğ¾Ğ´</span>
      </div>
    </Card>}

    {Object.keys(byM).length>0&&<Card style={{marginBottom:14}}>
      <div style={{fontSize:11,color:C.sub,letterSpacing:1,textTransform:"uppercase",marginBottom:12}}>ĞŸĞ¾ Ğ¼ĞµÑÑÑ†Ğ°Ğ¼</div>
      {Object.keys(byM).sort((a,b)=>b.localeCompare(a)).map(m=>{
        const{inc,exp}=byM[m];const p=inc-exp;
        return <div key={m} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"9px 0",borderBottom:`1px solid ${C.border}`}}>
          <span style={{fontSize:13,color:C.text}}>{mLabel(m)}</span>
          <div style={{textAlign:"right"}}>
            <div style={{fontSize:12,color:p>=0?C.green:C.red,fontWeight:700}}>{p>=0?"+":""}{fmt(p)}</div>
            <div style={{fontSize:10,color:C.sub}}>â†‘{fmt(inc)} â†“{fmt(exp)}</div>
          </div>
        </div>;
      })}
    </Card>}

    <button onClick={onExport} style={{width:"100%",padding:"14px",borderRadius:14,border:`1.5px solid ${C.border}`,background:"transparent",color:C.al,cursor:"pointer",fontSize:14,fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
      <span>ğŸ“¥</span> Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² Excel (CSV)
    </button>
  </div>;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// App â€” with real-time Firebase sync via onSnapshot
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const [tab,setTab] = useState("add");
  const [entries,setEntries] = useState([]);
  const [overrides,setOverrides] = useState({});
  const [loading,setLoading] = useState(true);
  const [sync,setSync] = useState("connecting");

  // Track saves to avoid echoing our own writes back
  const isSaving = useRef(false);

  useEffect(()=>{
    let unsubEntries = ()=>{};
    let unsubBalances = ()=>{};
    let unsubStatus = ()=>{};

    async function init(){
      const ok = await initFirebase();

      if (ok) {
        // Load initial data from Firebase
        try {
          const r = await loadOnce("entries");
          if(r) setEntries(JSON.parse(r));
        } catch(_){}
        try {
          const r = await loadOnce("balances");
          if(r) setOverrides(JSON.parse(r));
        } catch(_){}

        // Subscribe to real-time updates from other users
        unsubEntries = subscribe("entries", (value) => {
          if (isSaving.current) return;
          try { setEntries(JSON.parse(value)); } catch(_){}
        });

        unsubBalances = subscribe("balances", (value) => {
          if (isSaving.current) return;
          try { setOverrides(JSON.parse(value)); } catch(_){}
        });
      } else {
        // Fallback to localStorage
        try{const r=localStorage.getItem("at_entries");if(r)setEntries(JSON.parse(r));}catch(_){}
        try{const r=localStorage.getItem("at_balances");if(r)setOverrides(JSON.parse(r));}catch(_){}
      }

      unsubStatus = onStatusChange((s) => setSync(s));
      setSync(firebaseStatus);
      setLoading(false);
    }

    init();

    return () => {
      unsubEntries();
      unsubBalances();
      unsubStatus();
    };
  },[]);

  const saveEntries = useCallback(async (next) => {
    isSaving.current = true;
    setEntries(next);
    await saveData("entries", JSON.stringify(next));
    setTimeout(() => { isSaving.current = false; }, 1000);
  }, []);

  const saveOverrides = useCallback(async (next) => {
    isSaving.current = true;
    setOverrides(next);
    await saveData("balances", JSON.stringify(next));
    setTimeout(() => { isSaving.current = false; }, 1000);
  }, []);

  const tabs=[
    {id:"add",icon:"ï¼‹",label:"Ğ’Ğ½ĞµÑÑ‚Ğ¸"},
    {id:"history",icon:"â˜°",label:"Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ"},
    {id:"balances",icon:"âš–",label:"Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ"},
    {id:"dashboard",icon:"â—ˆ",label:"Ğ˜Ñ‚Ğ¾Ğ³Ğ¸"},
  ];

  return <>
    <div style={{maxWidth:430,margin:"0 auto",minHeight:"100vh",background:C.bg,display:"flex",flexDirection:"column"}}>
      <div style={{padding:"18px 18px 12px",background:"linear-gradient(180deg,#16163a 0%,#0f0f1e 100%)",borderBottom:`1px solid ${C.border}`}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}>
          <div>
            <div style={{fontFamily:"'Unbounded',sans-serif",fontSize:17,color:C.text,fontWeight:700,letterSpacing:-0.5}}>Air Time</div>
            <div style={{fontSize:10,color:C.muted,letterSpacing:1.5,textTransform:"uppercase"}}>Ñ„Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞºĞµÑ€</div>
          </div>
          <div style={{display:"flex",alignItems:"center",gap:8}}>
            <span className={`sync-dot ${sync}`} title={sync==="cloud"?"Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°":"Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼"}/>
            <div style={{width:38,height:38,borderRadius:11,background:"#7c3aed25",border:"1px solid #7c3aed44",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18}}>ğŸ¬</div>
          </div>
        </div>
      </div>

      <div style={{flex:1,padding:"18px 16px 84px",overflowY:"auto"}}>
        {loading
          ?<div style={{textAlign:"center",padding:"80px 0",color:C.sub,animation:"pulse 1.5s infinite"}}>
            <div style={{fontSize:32,marginBottom:10}}>â˜ï¸</div>
            ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ¾Ğ±Ğ»Ğ°ĞºÑƒ...
          </div>
          :<>
            {tab==="add"&&<EntryForm onSave={e=>saveEntries([...entries,e])}/>}
            {tab==="history"&&<History entries={entries} onDelete={id=>saveEntries(entries.filter(e=>e.id!==id))}/>}
            {tab==="balances"&&<BalanceCorrection overrides={overrides} onSave={saveOverrides}/>}
            {tab==="dashboard"&&<Dashboard entries={entries} overrides={overrides} onExport={()=>doExport(entries,overrides)} sync={sync}/>}
          </>
        }
      </div>

      <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:430,background:"#14143a",borderTop:`1px solid ${C.border}`,display:"flex",padding:"8px 0 14px"}}>
        {tabs.map(t=>(
          <button key={t.id} onClick={()=>setTab(t.id)} style={{flex:1,background:"none",border:"none",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:3,padding:"5px 0"}}>
            <span style={{fontSize:19,filter:tab===t.id?"none":"grayscale(1)",opacity:tab===t.id?1:0.35,transition:"all .2s"}}>{t.icon}</span>
            <span style={{fontSize:10,color:tab===t.id?C.al:C.muted,fontWeight:tab===t.id?600:400}}>{t.label}</span>
          </button>
        ))}
      </div>
    </div>
  </>;
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
